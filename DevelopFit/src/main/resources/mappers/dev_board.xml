<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dev.board">

	<resultMap type="boardDto" id="boardResultMap">
		<id column="BOARD_NUMBER" property="boardnumber" />
		<result column="MEMBER_ID" property="memberid" />
		<result column="BOARD_TITLE" property="boardtitle" />
		<result column="BOARD_CREATE_DATE" property="boardcreatedate" 
		javaType="java.util.Date" />
		<result column="BOARD_HIT" property="boardhit" />
	</resultMap>
	
<!-- 	게시글 리스트 = 게시판 -->
	<select id="boardSelectList" parameterType="map" resultMap="boardResultMap">
		SELECT C.BOARD_NUMBER, C.BOARD_TITLE, C.MEMBER_ID, 
		C.CREATE_DATE, C.BOARD_HIT
		FROM(   
			SELECT ROWNUM AS RNUM, C.BOARD_NUMBER, C.BOARD_TITLE, C.MEMBER_ID, 
			C.CREATE_DATE, C.BOARD_HIT
		    FROM(   
		    	SELECT B.BOARD_NUMBER, B.BOARD_TITLE, M.MEMBER_ID, 
		    	B.BOARD_CREATE_DATE, B.BOARD_HIT
		        FROM MEMBER M JOIN BOARD B ON M.MEMBER_NUMBER = B.MEMBER_NUMBER
		        ORDER BY CREATE_DATE DESC) C
		) C
		WHERE C.RNUM BETWEEN #{start} AND #{end}

	</select>
<!-- 	게시글 생성 -->
	<insert id="boardInsertOne" parameterType="boardDto"
		useGeneratedKeys="true" keyProperty="no">
		<selectKey keyProperty="no" resultType="int" order="BEFORE">
			SELECT BOARD_BOARD_NUMBER_SEQ.NEXTVAL
			FROM DUAL
		</selectKey>
		
		INSERT INTO BOARD
			(BOARD_NUMBER, BOARD_TITLE, BOARD_CONTENT, BOARD_CREATE_DATE, MEMBER_NUMBER)
		VALUES(#{board_number}, #{board_title}, #{board_content}, 
		SYSDATE, #{member_number})
	</insert>
	
<!-- 	게시글 수정을 위해 수정할 게시글 하나 선택 -->
	<select id="boardSelectOne" parameterType="int" resultMap="boardResultMap">
		SELECT BOARD_TITLE, BOARD_CONTENT
		FROM BOARD
		WHERE MEMBER_NUMBER = #{member_number}
	</select>
	
<!-- 	게시글 내용 업데이트 (제목, 내용) -->
	<update id="boardUpdateOne" parameterType="boardDto">
		UPDATE BOARD
		<set>
			<if test="title != ''">BOARD_TITLE = #{board_title},</if>
			<if test="content != ''">BOARD_CONTENT = #{board_content},</if>
		</set>
		WHERE MEMBER_NUMBER = #{member_number}
	</update>
	
<!-- 	게시글 내용 삭제 -->
	<delete id="boardDeleteOne" parameterType="int">
		DELETE FROM BOARD
		WHERE MEMBER_NUMBER = #{member_number}
	</delete>
	
<!-- 	페이징 기능을 위한 총 게시글 수 산출 -->
	<select id="boardSelectTotalCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM MEMBER
	</select>
	

</mapper>


