<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.dev.movieComment">
	<resultMap id="movieCommentResultMap" type="movieCommentDto">
		<id column="LINE_REVIEW_NUMBER" property="lineReviewNumber" />
		<result column="LINE_REVIEW_CONTEXT" property="lineReviewContext" />
		<result column="MEMBER_NUMBER" property="memberNumber" />
		<result column="MOVIE_NUMBER" property="movieNumber" />
	</resultMap>

	<select id="movieCommentSelectList" parameterType="map" resultMap="movieCommentResultMap">
		SELECT LR.LINE_REVIEW_NUMBER, M.MEMBER_ID, MV.MOVIE_TITLE, LR.LINE_REVIEW_CONTEXT
		FROM LINE_REVIEW LR JOIN MEMBER M
		        ON LR.MEMBER_NUMBER = M.MEMBER_NUMBER JOIN MOVIE MV
		                                                ON LR.MOVIE_NUMBER = MV.MOVIE_NUMBER
	</select>

	<insert id="movieCommentInsertOne" parameterType="movieCommentDto" useGeneratedKeys="true" keyProperty="lineReviewNumber">
		<selectKey keyProperty="lineReviewNumber" resultType="int" order="BEFORE">
			SELECT LINE_REVIEW_NUMBER_SEQ.NEXTVAL
			FROM DUAL
		</selectKey>
		INSERT INTO LINE_REVIEW
			(LINE_REVIEW_NUMBER, LINE_REVIEW_CONTEXT, MEMBER_NUMBER, MOVIE_NUMBER)
		VALUES(#{lineReviewNumber}, #{lineReviewContext}, #{memberNumber}, #{movieNumber})
	</insert>
	
	<select id="movieCommentSelectOne" parameterType="int" resultMap="movieCommentResultMap">
		SELECT LR.LINE_REVIEW_NUMBER, LR.LINE_REVIEW_CONTEXT, M.MEMBER_ID, MV.MOVIE_TITLE
		FROM LINE_REVIEW LR JOIN MEMBER M
		        ON LR.MEMBER_NUMBER = M.MEMBER_NUMBER JOIN MOVIE MV
		                                                ON LR.MOVIE_NUMBER = MV.MOVIE_NUMBER
		WHERE LINE_REVIEW_NUMBER = #{lineReviewNumber}
	</select>
	
	<update id="movieCommentUpdateOne" parameterType="movieCommentDto">
		UPDATE LINE_REVIEW
		<set>
			LINE_REVIEW_CONTEXT = #{lineReviewContext},
			MEMBER_NUMBER = #{memberNumber},
			MOVIE_NUMBER = #{movieNumber}
		</set>
		WHERE LINE_REVIEW_NUMBER = #{lineReviewNumber}
	</update>
	
	<delete id="movieCommentDeleteOne" parameterType="int">
		DELETE FROM LINE_REVIEW
		WHERE LINE_REVIEW_NUMBER = #{lineReviewNumber}
	</delete>
	
	<select id="movieCommentSelectTotalCount" resultType="java.lang.Integer">
		SELECT COUNT(*)
		FROM LINE_REVIEW
	</select>
</mapper>